{% extends 'base.html.twig' %}

{% block title %}Hello ArticleController!
{% endblock %}

{% block body %}
	<div class="container">
		{% for message in app.flashes('success') %}
			<div class="alert alert--success">
				{{ message }}
			</div>
		{% endfor %}
		{% for message in app.flashes('edit') %}
			<div class="alert alert--edit">
				{{ message }}
			</div>
		{% endfor %}
		{% for message in app.flashes('delete') %}
			<div class="alert alert--delete">
				{{ message }}
			</div>
		{% endfor %}
		<div class="container--article">


			{% for article in articles %}
				<h2>{{ article.title}}</h2>
				<a href="{{path('app_view_articles', {slug: article.slug}) }}" class="container--article__link">
					<img src="{{ vich_uploader_asset(article) }}" alt="{{ article.title }}">
				</a>
				{% if article.content | length > 300 %}
					<p>{{ article.content|u.truncate(300, '...', false) | raw}}
						<a href="{{path('app_view_articles', {slug: article.slug}) }}">Voir plus</a>
					</p>
				{% else %}
					<p>{{article.content | raw}}..
						<a href="{{path('app_view_articles', {slug: article.slug}) }}">Voir plus</a>
					</p>
				{% endif %}


				<span class="container--article__infos">
					<span class="container--article__author">
						par
						{% if article.author.pseudo %}
							{{article.author.pseudo | capitalize}}
						{% else %}
							{{article.author.firstName | capitalize}}
							{{article.author.lastName | slice(0,1) | capitalize}}.
						{% endif %}
					</span>
					<span class="container--article__actions">
						{% if is_granted("ROLE_USER") %}
							{% if article.author.id == app.user.id %}
								<a href="{{path('app_edit_articles', {slug: article.slug })}}" class="button--edit">Modifier</a>
								<a href="{{path('app_delete_articles', {slug: article.slug, _csrf_token: csrf_token('delete-article') })}}" class="button--delete">Supprimer</a>
							{% endif %}
						{% endif %}
					</span>
				</span>
			{% endfor %}
			{{ knp_pagination_render(articles) }}
		</div>
	</div>

	{% if is_granted("ROLE_USER") %}
		<a href="{{path('app_add_articles')}}" class="button__add">+</a>
	{% endif %}

{% endblock %}
